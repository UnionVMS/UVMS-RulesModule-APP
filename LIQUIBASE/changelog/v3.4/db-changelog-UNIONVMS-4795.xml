<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">
    <changeSet id="UNIONVMS-4795-Prevent-missing-master-or-agent-name-information" author="nomikosi">
        <insert tableName="rule">
            <column name="rule_id" value="620" />
            <column name="br_id" value="FA-L00-00-0620" />
            <column name="note" value="SpecifiedContactPerson is mandatory for the reporting vessel."/>
            <column name="level" value="L00"/>
            <column name="error_type" value="ERROR"/>
            <column name="rule_created_on" valueDate="2017-12-07 00:00:00.0"/>
            <column name="template_id" value="3"/>
            <column name="property_names" value="specifiedContactPersons"/>
            <column name="disabled" value="false"/>
        </insert>

        <insert tableName="context_expression">
            <column name="id" value="620"/>
            <column name="rule_id" value="620"/>
            <column name="context" value="EU"/>
            <column name="expression"
                    value="specifiedContactPersons == null || isEmpty(specifiedContactPersons)"/>
            <column name="failure_message" value="SpecifiedContactPerson is mandatory for the reporting vessel."/>
        </insert>

        <insert tableName="rule">
            <column name="rule_id" value="621" />
            <column name="br_id" value="FA-L00-00-0621" />
            <column name="note" value="RoleCode is mandatory for Specified ContactParty"/>
            <column name="level" value="L00"/>
            <column name="error_type" value="ERROR"/>
            <column name="rule_created_on" valueDate="2017-12-07 00:00:00.0"/>
            <column name="template_id" value="3"/>
            <column name="property_names" value="specifiedContactPartyRoleCodes"/>
            <column name="disabled" value="false"/>
        </insert>

        <insert tableName="context_expression">
            <column name="id" value="621"/>
            <column name="rule_id" value="621"/>
            <column name="context" value="EU"/>
            <column name="expression"
                    value="roleCode != null &amp;&amp; roleCode.value == &quot;PAIR_FISHING_PARTNER&quot; &amp;&amp; isEmpty(specifiedContactPartyRoleCodes)"/>
            <column name="failure_message" value="RoleCode is mandatory for Specified ContactParty"/>
        </insert>

    <rollback>
        <delete tableName="context_expression">
            <where>rule_id=:value</where>
            <whereParams>
                <param name="value" value="620" />
            </whereParams>
        </delete>
        <delete tableName="rule">
            <where>rule_id=:value</where>
            <whereParams>
                <param name="value" value="620" />
            </whereParams>
        </delete>

        <delete tableName="context_expression">
            <where>rule_id=:value</where>
            <whereParams>
                <param name="value" value="621" />
            </whereParams>
        </delete>
        <delete tableName="rule">
            <where>rule_id=:value</where>
            <whereParams>
                <param name="value" value="621" />
            </whereParams>
        </delete>
    </rollback>
    </changeSet>
</databaseChangeLog>
